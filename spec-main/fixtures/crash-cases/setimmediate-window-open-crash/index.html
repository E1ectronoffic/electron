<html>
<body>
<script>
setImmediate(async () => {
  if (!location.hash) {
    const p = new Promise(resolve => {
      window.addEventListener('message', resolve, { once: true });
    })
    window.open('#foo', '', 'nodeIntegration=no')
    const e = await p
    document.body.textContent = e.data

    window.close();
  } else {
    window.opener.postMessage('foo', '*')
  }
})
</script>
test
</body>
</html>
